<!-- app/templates/payments/new_payment.html (VERSIÓN CORREGIDA) -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrar Pago - Yasta</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/hyperscript.org@0.9.12"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        #payment-modal {
            transition: border-color 0.3s ease-in-out;
        }
    </style>
</head>
<body 
    class="bg-gray-900 text-white flex items-center justify-center h-screen font-sans"
    
    _="on load
        set yapeColor to '#5A008A'
        set plinColor to '#00A99D'
        
        set initialRadio to <input[name=origen_app]:checked/>
        if initialRadio.value is 'yape'
            remove .hidden from #codigo-seguridad-wrapper
            set #payment-modal.style.borderColor to yapeColor
            remove .hidden from #yape-logo
            add .hidden to #plin-logo
        else
            add .hidden to #codigo-seguridad-wrapper
            set #payment-modal.style.borderColor to plinColor
            add .hidden to #yape-logo
            remove .hidden from #plin-logo
        end"
>

    <div id="payment-modal" class="bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-md border-4 border-transparent">
        
        <div class="flex justify-center mb-6 h-16">
            <!-- He reemplazado las URLs de imgur por unas más estables -->
            <img id="yape-logo" src="{{ url_for('static', path='img/yape-logo.png') }}" alt="Logo Yape" class="h-full">
            <img id="plin-logo" src="{{ url_for('static', path='img/plin-logo.jpg') }}" alt="Logo Plin" class="h-full hidden">
        </div>

        <h2 class="text-2xl font-bold mb-6 text-center">Registra tu Pago</h2>
        
        <div id="payment-result">

            <form 
                hx-post="/app/payments/manual-entry"
                hx-target="#payment-result"
                hx-swap="innerHTML"
                hx-indicator="#loading-spinner"
                class="space-y-6"
            >
                <div>
                    <label for="monto_pagado" class="block text-sm font-medium text-gray-400">Monto Pagado (S/.)</label>
                    <input type="number" step="0.01" name="monto_pagado" id="monto_pagado" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 h-12 text-lg px-4">
                </div>
                
                <div>
                    <label for="numero_operacion" class="block text-sm font-medium text-gray-400">Número de Operación</label>
                    <input type="text" name="numero_operacion" id="numero_operacion" required class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 h-12 text-lg px-4">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">Plataforma</label>
                    <div class="grid grid-cols-2 gap-4">
                        <label class="flex items-center justify-center p-4 bg-gray-700 rounded-lg border-2 border-transparent cursor-pointer has-[:checked]:border-indigo-500 has-[:checked]:bg-gray-600">
                            <input type="radio" name="origen_app" value="yape" checked 
                                   _ = "on change
                                        remove .hidden from #codigo-seguridad-wrapper
                                        set #payment-modal.style.borderColor to '#5A008A'
                                        remove .hidden from #yape-logo
                                        add .hidden to #plin-logo"
                                   class="absolute opacity-0">
                            <span class="text-lg font-semibold">Yape</span>
                        </label>
                        <label class="flex items-center justify-center p-4 bg-gray-700 rounded-lg border-2 border-transparent cursor-pointer has-[:checked]:border-indigo-500 has-[:checked]:bg-gray-600">
                            <input type="radio" name="origen_app" value="plin"
                                   _ = "on change
                                        add .hidden to #codigo-seguridad-wrapper
                                        set #payment-modal.style.borderColor to '#00A99D'
                                        add .hidden to #yape-logo
                                        remove .hidden from #plin-logo"
                                   class="absolute opacity-0">
                            <span class="text-lg font-semibold">Plin</span>
                        </label>
                    </div>
                </div>

                <div id="codigo-seguridad-wrapper">
                    <label for="codigo_seguridad" class="block text-sm font-medium text-gray-400">Código de Seguridad (Opcional)</label>
                    <input type="text" name="codigo_seguridad" id="codigo_seguridad" 
                           maxlength="3" pattern="[0-9]{3}"
                           placeholder="Ej: 837"
                           class="mt-1 block w-full bg-gray-700 border-gray-600 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 h-12 text-lg px-4">
                </div>

                <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center text-lg">
                    <span>Registrar Pago</span>
                    <svg id="loading-spinner" class="htmx-indicator animate-spin ml-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
            </form>
        </div>
    </div>

</body>
</html>