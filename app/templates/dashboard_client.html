{% extends 'layouts/_app_base.html' %}

{% block title %}Mi Dashboard - YASTA{% endblock %}

{% block page_css %}
    <style>
        .dashboard-grid { display: grid; grid-template-columns: repeat(1, minmax(0, 1fr)); gap: 1.5rem; }
        @media (min-width: 768px) { .dashboard-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
        @media (min-width: 1280px) { .dashboard-grid { grid-template-columns: repeat(3, minmax(0, 1fr)); } }
        .dashboard-widget { background-color: #1f2937; border-radius: 0.75rem; padding: 1.5rem; border: 1px solid #374151; }
        .widget-title { font-size: 1.125rem; font-weight: 600; color: #f9fafb; margin-bottom: 1rem; }
        .kpi-value { font-size: 2.25rem; font-weight: 800; color: #ffffff; }
        .kpi-label { font-size: 0.875rem; color: #9ca3af; }
        .chart-container-widget { height: 250px; }
    </style>
{% endblock %}


{% block sub_nav_content %}
    {% if current_user.sol_validation_status.value == 'valid' %}
        <div class="flex items-center space-x-4">
            <a href="#" class="px-1 py-2 text-sm font-semibold text-white border-b-2 border-indigo-500">Resumen</a>
            <!-- ... otros enlaces ... -->
        </div>
    {% endif %}
{% endblock %}


{% block main_content %}
<div class="container mx-auto px-4">
    {% if current_user.sol_validation_status.value != 'valid' %}
        <!-- Vista de Onboarding -->
    {% else %}
        <!-- DASHBOARD COMPLETO -->
        <div>
            <header class="mb-8 flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold text-white">Resumen del Periodo</h1>
                    <p class="text-gray-400 mt-1">Hola {{ current_user.contact_name }}, aquí tienes un vistazo rápido.</p>
                </div>
                <div>
                    <!-- Botón que USA TU SISTEMA: añade la clase 'active' -->
                    <button 
                        _="on click add .active to #payment-modal"
                        class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 px-4 rounded-lg">
                        Registrar un Pago
                    </button>
                </div>
            </header>
            <div class="dashboard-grid">
                <div class="dashboard-widget"><h3 class="widget-title">Impuesto por Pagar (Junio)</h3><p class="kpi-value">S/ 1,250.00</p><p class="kpi-label">IGV + Renta</p></div>
                <div class="dashboard-widget"><h3 class="widget-title">Próximo Vencimiento</h3><p class="kpi-value text-yellow-400">En 5 días</p><p class="kpi-label">Declaración PLAME</p></div>
                <div class="dashboard-widget"><h3 class="widget-title">Alertas Activas</h3><p class="kpi-value text-red-500">1</p><p class="kpi-label">Orden de Pago pendiente</p></div>
                <div class="dashboard-widget xl:col-span-2"><h3 class="widget-title">Historial de Impuestos Pagados</h3><div class="chart-container-widget"><canvas id="clientLineChart"></canvas></div></div>
                <div class="dashboard-widget"><h3 class="widget-title">Distribución de Gastos</h3><div class="chart-container-widget"><canvas id="clientPieChart"></canvas></div></div>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}


{% block body_end_scripts %}
    <!-- Modal que AHORA USA TU SISTEMA: tiene la clase '.modal' -->
    <div id="payment-modal" 
         class="modal"
         hx-get="/app/payments/new?cache_bust={{ now() | int }}" 
         hx-trigger="load" 
         hx-target="#payment-modal-content"
         hx-swap="innerHTML">
        <div id="payment-modal-content">
            <!-- El contenido del formulario se cargará aquí -->
            <div class="htmx-indicator text-white text-center"><p>Cargando...</p></div>
        </div>
    </div>
{% endblock %}

{% block page_scripts %}
    {% if current_user.sol_validation_status.value == 'valid' %}
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <!-- ... script de charts ... -->
    {% endif %}
{% endblock %}